# План тестирования с реальными медиафайлами

## Обнаруженные особенности тестовых файлов

### Видеофайлы:
1. **C0666.MP4** и **C0783.MP4**:
   - 4K разрешение (3840x2160)
   - HEVC кодек (H.265)
   - 50 fps
   - PCM аудио (несжатое)
   - Очень высокий битрейт (~200 Mbps)

2. **Kate.mp4**:
   - 4K разрешение
   - H.264 кодек (более совместимый)
   - AAC аудио (стандартное сжатие)
   - 44.1kHz вместо 48kHz

3. **water play3.mp4**:
   - Только видео, без аудио
   - HEVC кодек
   - Короткая длительность (3.4 сек)

4. **проводка после лобби.mp4**:
   - Кириллица в названии файла
   - Только видео, без аудио
   - Самый длинный файл (19.9 сек)

### Аудиофайл:
- **DJI_02_20250402_104352.WAV**:
  - Очень длинный (31 минута)
  - 24-bit PCM (высокое качество)
  - Моно канал
  - Большой размер (256 MB)

### Изображение:
- **DSC07845.png**:
  - Высокое разрешение (4240x2832)
  - PNG формат

## Тестовые сценарии для Rust

### 1. Тесты обработки метаданных (`metadata.rs`)
- [x] Извлечение метаданных из HEVC видео (`test_extract_metadata_from_hevc_video`)
- [x] Обработка PCM аудио в MP4 контейнере (`test_pcm_audio_in_mp4`)
- [x] Работа с длинными аудиофайлами (31 мин) (`test_extract_metadata_from_long_audio`)
- [x] Обработка видео без аудио дорожки (`test_video_without_audio`)
- [x] Обработка различных частот дискретизации (`test_different_sample_rates`)

### 2. Тесты генерации превью (`thumbnail.rs`)
- [x] Генерация превью для 4K видео (`test_thumbnail_generation_4k_video`)
- [x] Обработка HEVC кодека (`test_hevc_codec_handling`)
- [x] Извлечение кадра из видео без аудио (`test_extract_frame_from_video_without_audio`)
- [x] Производительность для больших файлов (256MB) (`test_large_file_performance`)

### 3. Тесты файловой системы (`filesystem.rs`)
- [x] Работа с файлами с кириллицей в названии (`test_handle_cyrillic_filename`)
- [x] Обработка путей с пробелами (`test_paths_with_spaces`)
- [x] Чтение больших файлов (покрыто в `test_large_file_performance`)

### 4. Тесты видео компилятора (`video_compiler`)
- [x] Компиляция 4K видео (`test_4k_video_compilation`)
- [x] Работа с различными кодеками (тест `test_codec_variety`)
- [x] Микширование видео с разными аудио форматами (`test_mixed_audio_formats`)
- [x] Обработка видео без аудио (`test_mixed_content_project`)

### 5. Тесты производительности
- [x] Параллельная обработка нескольких 4K файлов (`test_parallel_processing`)
- [x] Использование памяти при обработке больших файлов (`test_memory_usage_large_files`)
- [x] Скорость извлечения метаданных (замеры в каждом тесте)
- [x] Обработка файлов с высоким битрейтом (`test_high_bitrate_handling`)

### 6. Интеграционные тесты
- [x] Полный цикл: импорт -> обработка (`test_full_import_cycle`)
- [x] Обработка всех файлов из папки test-data (в `test_full_import_cycle`)
- [x] Восстановление после ошибок (`test_error_recovery`)

## Специфические edge cases

1. **Высокий битрейт**: Файлы с битрейтом 200+ Mbps могут требовать особой обработки
2. **PCM аудио в MP4**: Нестандартная комбинация, может вызвать проблемы совместимости
3. **Различные fps**: Нужно правильно обрабатывать 50fps видео
4. **Смешанный контент**: Видео с аудио и без в одном проекте
5. **Большие файлы**: Обработка файлов 250+ MB без блокировки UI

## Рекомендации по реализации

1. Создать модуль `test_data.rs` с константами из реальных файлов
2. Использовать `lazy_static` для кеширования метаданных тестовых файлов
3. Добавить бенчмарки для критичных операций
4. Создать моки для тестов, которые не требуют реальных файлов
5. Добавить проверки производительности в CI/CD