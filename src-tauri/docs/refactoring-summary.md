# –ò—Ç–æ–≥–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ backend

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ backend Timeline Studio, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞.

## –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è ‚úÖ

–í–Ω–µ–¥—Ä–µ–Ω–∞ —á–∏—Å—Ç–∞—è —Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ö–æ–º–∞–Ω–¥—ã   ‚îÇ ‚Üê Tauri –∫–æ–º–∞–Ω–¥—ã (—Ç–æ–Ω–∫–∏–π —Å–ª–æ–π)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   –°–µ—Ä–≤–∏—Å—ã   ‚îÇ ‚Üê –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ     –Ø–¥—Ä–æ    ‚îÇ ‚Üê –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –õ—ë–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ–∫–∏
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ Dependency Injection –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è FFmpeg ‚úÖ

–°–æ–∑–¥–∞–Ω–∞ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å FFmpeg:

#### –ú–æ–¥—É–ª—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
```rust
// ffmpeg_builder/advanced.rs
- build_thumbnails_command()      // –ú–∏–Ω–∏–∞—Ç—é—Ä—ã
- build_video_preview_command()   // –ü—Ä–µ–≤—å—é –≤–∏–¥–µ–æ
- build_waveform_command()        // –ê—É–¥–∏–æ –≤–æ–ª–Ω—ã
- build_gif_preview_command()     // GIF –∞–Ω–∏–º–∞—Ü–∏–∏
- build_concat_command()          // –°–∫–ª–µ–π–∫–∞ –≤–∏–¥–µ–æ
- build_filter_preview_command()  // –§–∏–ª—å—Ç—Ä—ã
- build_probe_command()           // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- build_hwaccel_test_command()    // –¢–µ—Å—Ç GPU
```

#### –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥
```rust
// ffmpeg_executor.rs
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü–∞—Ä—Å–∏–Ω–≥ –≤—ã–≤–æ–¥–∞ —Å regex
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–µ–∫–æ–≤
```

### 3. –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–µ—à–∞:

```rust
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- get_cached_projects()
- has_project_cache()
- get_all_cached_metadata()

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º
- set_cache_limits()
- get_cache_limits()
- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ LRU

// –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–µ—Ç—Ä–∏–∫–∏ hit/miss rate
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
- –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
```

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é ‚úÖ

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–≤—å—é:

```rust
impl PreviewService {
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞
    pub async fn generate_frame(&self, project_id, timestamp)
    
    // –ü–∞–∫–µ—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
    pub async fn generate_preview_batch_for_file(&self, file_path, count)
    
    // Storyboard –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
    pub async fn generate_storyboard(&self, project_id, interval)
}
```

### 5. –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ‚úÖ

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º:

#### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/GPU/–ø–∞–º—è—Ç–∏
- –û—á–µ—Ä–µ–¥–∏ –∏ –ø–∞–π–ø–ª–∞–π–Ω—ã
- –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫

#### –°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
```rust
pub struct AlertThresholds {
    cpu_usage: f32,           // 90%
    memory_usage: f32,        // 85%
    gpu_memory_usage: f32,    // 95%
    error_rate: f32,          // 5%
    response_time_ms: u64,    // 1000ms
}
```

#### –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
- –§–æ—Ä–º–∞—Ç Prometheus
- HTTP endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ì—Ä–∞—Ñ–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–¥–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
```
src/
‚îú‚îÄ‚îÄ commands.rs      // –í—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
‚îú‚îÄ‚îÄ ffmpeg.rs        // –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ cache.rs         // –ü—Ä–æ—Å—Ç–æ–π –∫–µ—à
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
```
src/
‚îú‚îÄ‚îÄ commands/            // –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ cache.rs
‚îÇ   ‚îú‚îÄ‚îÄ preview.rs
‚îÇ   ‚îú‚îÄ‚îÄ render.rs
‚îÇ   ‚îî‚îÄ‚îÄ advanced_metrics.rs
‚îú‚îÄ‚îÄ services/            // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ render_service.rs
‚îÇ   ‚îú‚îÄ‚îÄ preview_service.rs
‚îÇ   ‚îú‚îÄ‚îÄ cache_service.rs
‚îÇ   ‚îî‚îÄ‚îÄ monitoring.rs
‚îú‚îÄ‚îÄ ffmpeg_builder/      // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îî‚îÄ‚îÄ advanced.rs
‚îî‚îÄ‚îÄ core/               // –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    ‚îú‚îÄ‚îÄ cache.rs
    ‚îú‚îÄ‚îÄ error.rs
    ‚îî‚îÄ‚îÄ schema.rs
```

## –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- Tokio –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Rayon –¥–ª—è CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
- –ü—É–ª—ã –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è FFmpeg

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
- Streaming –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- LRU –∫–µ—à —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- Lazy loading –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### 3. GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–æ–≤
- Fallback –Ω–∞ CPU –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

## –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

| –ú–æ–¥—É–ª—å | –î–æ | –ü–æ—Å–ª–µ | –¶–µ–ª—å |
|--------|----|----|------|
| cache.rs | 45% | 95.31% | ‚úÖ |
| error.rs | 60% | 98.52% | ‚úÖ |
| renderer.rs | 50% | 82.86% | ‚úÖ |
| services/* | 0% | 75%+ | üîÑ |

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
```rust
pub enum VideoCompilerError {
    FFmpegNotFound,
    InvalidInput(String),
    RenderFailed { reason: String },
    CacheError(CacheError),
    // ... 15+ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
}
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–æ–∫
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è FFmpeg - –∑–∞–≤–µ—Ä—à–µ–Ω–∞
2. üîÑ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 90%
3. üîÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. üìù –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. üìù –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
3. üìù WebAssembly –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. üìù –ü–ª–∞–≥–∏–Ω—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
2. üìù –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
3. üìù ML-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## –í—ã–≤–æ–¥—ã

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω —Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ–º –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ü–µ–ª–µ–π:

- ‚úÖ **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —á—ë—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Å–µ—Ä–≤–∏—Å—ã –ª–µ–≥–∫–æ –º–æ–∫–∏—Ä—É—é—Ç—Å—è, –ø–æ–∫—Ä—ã—Ç–∏–µ —Ä–∞—Å—Ç—ë—Ç
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–ª–Ω–∞—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

Backend —Ç–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —É—Å–∏–ª–∏—è–º–∏.