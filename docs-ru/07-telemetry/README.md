# Telemetry System / –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –º–µ—Ç—Ä–∏–∫ –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ Timeline Studio —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π OpenTelemetry —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –∑–¥–æ—Ä–æ–≤—å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ Timeline Studio –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç comprehensive –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ OpenTelemetry —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –≥–∏–±–∫–æ—Å—Ç–∏.

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏, —Ç—Ä–µ–π—Å—ã –∏ –ª–æ–≥–∏
- **Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ updates —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
- **Health checks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- **Performance tracking** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Export –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ backend'—ã** - Prometheus, Jaeger, Grafana –∏ –¥—Ä.
- **Comprehensive testing** - 34 unit —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [**Configuration Guide**](configuration.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
- [**Installation Guide**](installation.md) - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [**Environment Setup**](environment.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è dev/prod

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
- [**Monitoring Setup**](monitoring.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ production
- [**Dashboards**](dashboards.md) - –ì–æ—Ç–æ–≤—ã–µ dashboard'—ã –¥–ª—è Grafana
- [**Alerting Rules**](alerting.md) - –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [**OpenTelemetry Guide**](opentelemetry.md) - –†–∞–±–æ—Ç–∞ —Å OpenTelemetry
- [**Custom Metrics**](custom-metrics.md) - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
- [**Distributed Tracing**](tracing.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ distributed tracing

### Troubleshooting –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [**Performance Analysis**](performance-analysis.md) - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [**Troubleshooting Guide**](troubleshooting.md) - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- [**Best Practices**](best-practices.md) - –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```rust
use timeline_studio::core::telemetry::*;

#[tokio::main]
async fn main() -> Result<()> {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    let config = TelemetryConfig {
        enabled: true,
        service_name: "timeline-studio".to_string(),
        service_version: "1.0.0".to_string(),
        
        tracing: TracingConfig {
            enabled: true,
            sample_rate: 0.1,  // 10% —Ç—Ä–µ–π—Å–æ–≤
            exporters: vec![
                TracingExporter::Console,
                TracingExporter::Jaeger { 
                    endpoint: "http://localhost:14268/api/traces".to_string() 
                },
            ],
            ..Default::default()
        },
        
        metrics: MetricsConfig {
            enabled: true,
            collection_interval: Duration::from_secs(10),
            exporters: vec![
                MetricsExporter::Prometheus { port: 9090 },
                MetricsExporter::Console,
            ],
            ..Default::default()
        },
        
        health: HealthConfig {
            enabled: true,
            check_interval: Duration::from_secs(30),
            cache_ttl: Duration::from_secs(60),
            default_timeout: Duration::from_secs(5),
        },
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
    let telemetry = TelemetryManager::new(config).await?;
    telemetry.initialize().await?;
    
    // –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–¥–µ—Å—å...
    
    Ok(())
}
```

### 2. –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫

```rust
use timeline_studio::core::telemetry::Metrics;

async fn example_video_processing(metrics: Arc<Metrics>) -> Result<()> {
    // –°—á–µ—Ç—á–∏–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
    metrics.increment_counter("videos_processed_total", 1).await?;
    
    // –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
    let memory_usage = get_memory_usage();
    metrics.set_gauge("memory_usage_bytes", memory_usage as f64).await?;
    
    // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–¥—Ä–∞
    let start = Instant::now();
    process_video_frame().await?;
    let duration = start.elapsed().as_millis() as f64;
    
    metrics.record_histogram("frame_processing_duration_ms", duration).await?;
    
    // –ú–µ—Ç—Ä–∏–∫–∏ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
    metrics.increment_counter_with_attributes(
        "api_requests_total",
        1,
        vec![("method", "POST"), ("endpoint", "/render"), ("status", "success")]
    ).await?;
    
    Ok(())
}
```

### 3. Health Checks

```rust
use timeline_studio::core::telemetry::{HealthCheckManager, HealthCheck, HealthStatus, HealthCheckResult};

// –°–æ–∑–¥–∞–Ω–∏–µ custom health check
struct DatabaseHealthCheck {
    connection_pool: Arc<DbPool>,
}

#[async_trait]
impl HealthCheck for DatabaseHealthCheck {
    fn name(&self) -> &str { "database" }
    
    async fn check(&self) -> HealthCheckResult {
        let start = Instant::now();
        
        match self.connection_pool.get_connection().await {
            Ok(_) => HealthCheckResult {
                status: HealthStatus::Healthy,
                message: "Database connection successful".to_string(),
                timestamp: SystemTime::now(),
                check_duration: start.elapsed(),
                metadata: HashMap::new(),
            },
            Err(e) => HealthCheckResult {
                status: HealthStatus::Unhealthy,
                message: format!("Database connection failed: {}", e),
                timestamp: SystemTime::now(),
                check_duration: start.elapsed(),
                metadata: HashMap::new(),
            }
        }
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ health checks
async fn setup_health_checks() -> Result<()> {
    let health_manager = HealthCheckManager::new();
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
    health_manager.add_check(Box::new(DatabaseHealthCheck::new(db_pool))).await;
    health_manager.add_check(Box::new(DiskSpaceHealthCheck::new("/tmp", 0.9))).await;
    health_manager.add_check(Box::new(MemoryHealthCheck::new(0.8))).await;
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
    health_manager.set_cache_ttl(Duration::from_secs(60));
    health_manager.set_default_timeout(Duration::from_secs(10));
    
    // –ó–∞–ø—É—Å–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
    tokio::spawn(async move {
        let mut interval = tokio::time::interval(Duration::from_secs(30));
        loop {
            interval.tick().await;
            if let Err(e) = health_manager.check_all().await {
                log::error!("Health check failed: {:?}", e);
            }
        }
    });
    
    Ok(())
}
```

### 4. Distributed Tracing

```rust
use timeline_studio::core::telemetry::Tracer;

async fn example_traced_operation(tracer: Arc<Tracer>) -> Result<()> {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–π—Å–∏–Ω–≥
    tracer.trace_async("video_render_pipeline", |span| async move {
        span.set_attribute("video_id", "12345");
        span.set_attribute("resolution", "1920x1080");
        span.set_attribute("codec", "h264");
        
        // –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
        span.add_event("preparation_started");
        prepare_video_data().await?;
        span.add_event("preparation_completed");
        
        // –≠—Ç–∞–ø 2: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å child span
        let render_result = tracer.trace_async("video_render", |render_span| async move {
            render_span.set_attribute("frames_count", "3600");
            render_span.set_attribute("target_fps", "30");
            
            render_video_frames().await
        }).await?;
        
        // –≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
        span.add_event("finalization_started");
        finalize_video(render_result).await?;
        span.add_event("finalization_completed");
        
        Ok(())
    }).await
}

// –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ spans –¥–ª—è complex —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
async fn manual_tracing_example(tracer: Arc<Tracer>) -> Result<()> {
    let main_span = tracer.span_builder("complex_video_operation")
        .with_attribute("operation_type", "batch_processing")
        .with_attribute("batch_size", "50")
        .start(&tracer);
    
    for i in 0..50 {
        let item_span = tracer.span_builder(&format!("process_item_{}", i))
            .with_attribute("item_index", &i.to_string())
            .with_parent(&main_span)
            .start(&tracer);
        
        match process_single_item(i).await {
            Ok(result) => {
                item_span.set_attribute("result_size", &result.len().to_string());
                item_span.add_event("processing_successful");
            },
            Err(e) => {
                item_span.set_attribute("error", &e.to_string());
                item_span.add_event("processing_failed");
            }
        }
        
        item_span.end();
    }
    
    main_span.end();
    Ok(())
}
```

## üìä –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```rust
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
system_cpu_usage_percent          // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU (%)
system_memory_usage_bytes         // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (bytes) 
system_memory_available_bytes     // –î–æ—Å—Ç—É–ø–Ω–∞—è –ø–∞–º—è—Ç—å (bytes)
system_disk_usage_bytes          // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ (bytes)
system_disk_available_bytes      // –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ (bytes)
system_network_bytes_sent        // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ —Å–µ—Ç–∏ (bytes)
system_network_bytes_received    // –ü–æ–ª—É—á–µ–Ω–æ –ø–æ —Å–µ—Ç–∏ (bytes)
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
```rust
// –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
video_processing_duration_ms     // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ (ms)
frame_processing_duration_ms     // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–¥—Ä–∞ (ms)
frames_processed_total           // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤
videos_processed_total           // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
encoding_speed_fps               // –°–∫–æ—Ä–æ—Å—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (fps)

// API –∏ –∑–∞–ø—Ä–æ—Å—ã
api_requests_total               // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ API –∑–∞–ø—Ä–æ—Å–æ–≤
api_request_duration_ms          // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API –∑–∞–ø—Ä–æ—Å–æ–≤ (ms)
api_errors_total                 // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API

// –ö—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
cache_hits_total                 // –ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à
cache_misses_total               // –ü—Ä–æ–º–∞—Ö–∏ –∫—ç—à–∞
cache_evictions_total            // –í—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –∏–∑ –∫—ç—à–∞
cache_size_bytes                 // –†–∞–∑–º–µ—Ä –∫—ç—à–∞ (bytes)

// Runtime –º–µ—Ç—Ä–∏–∫–∏
worker_pool_utilization          // –ó–∞–≥—Ä—É–∑–∫–∞ worker pools (0-1)
tasks_executed_total             // –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
tasks_failed_total               // –ù–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
queue_size                       // –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á
```

### Health —Å—Ç–∞—Ç—É—Å—ã
```rust
// –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
system_health_status             // 0=Unknown, 1=Healthy, 2=Warning, 3=Unhealthy

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
database_health_status           // –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
disk_space_health_status         // –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
memory_health_status             // –î–æ—Å—Ç—É–ø–Ω–∞—è –ø–∞–º—è—Ç—å
external_api_health_status       // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö API
ffmpeg_health_status             // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å FFmpeg
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

### Development –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```json
{
  "telemetry": {
    "enabled": true,
    "service_name": "timeline-studio-dev",
    "service_version": "dev-build",
    
    "tracing": {
      "enabled": true,
      "sample_rate": 1.0,
      "max_attributes_per_span": 128,
      "max_events_per_span": 256,
      "exporters": [
        {"Console": {}},
        {"File": {"path": "./logs/traces.json"}}
      ]
    },
    
    "metrics": {
      "enabled": true,
      "collection_interval": "5s",
      "retention_period": "1h",
      "exporters": [
        {"Console": {}},
        {"File": {"path": "./logs/metrics.json"}}
      ]
    },
    
    "health": {
      "enabled": true,
      "check_interval": "10s",
      "cache_ttl": "30s",
      "default_timeout": "2s"
    }
  }
}
```

### Production –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```json
{
  "telemetry": {
    "enabled": true,
    "service_name": "timeline-studio",
    "service_version": "1.0.0",
    
    "tracing": {
      "enabled": true,
      "sample_rate": 0.01,
      "max_attributes_per_span": 32,
      "max_events_per_span": 64,
      "exporters": [
        {
          "Jaeger": {
            "endpoint": "http://jaeger-collector:14268/api/traces"
          }
        }
      ]
    },
    
    "metrics": {
      "enabled": true,
      "collection_interval": "15s",
      "retention_period": "24h",
      "exporters": [
        {
          "Prometheus": {
            "port": 9090,
            "path": "/metrics"
          }
        }
      ]
    },
    
    "health": {
      "enabled": true,
      "check_interval": "30s",
      "cache_ttl": "60s",
      "default_timeout": "5s"
    }
  }
}
```

### High-load –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```json
{
  "telemetry": {
    "enabled": true,
    "service_name": "timeline-studio-cluster",
    "service_version": "1.0.0",
    
    "tracing": {
      "enabled": true,
      "sample_rate": 0.001,
      "max_attributes_per_span": 16,
      "max_events_per_span": 32,
      "batch_export": {
        "max_batch_size": 1000,
        "max_export_timeout": "10s",
        "export_interval": "30s"
      },
      "exporters": [
        {
          "Jaeger": {
            "endpoint": "http://jaeger-cluster:14268/api/traces",
            "compression": "gzip"
          }
        }
      ]
    },
    
    "metrics": {
      "enabled": true,
      "collection_interval": "30s",
      "retention_period": "7d",
      "aggregation": {
        "histogram_buckets": [0.001, 0.01, 0.1, 1, 10, 100, 1000],
        "summary_quantiles": [0.5, 0.9, 0.95, 0.99]
      },
      "exporters": [
        {
          "Prometheus": {
            "port": 9090,
            "path": "/metrics",
            "enable_compression": true
          }
        }
      ]
    },
    
    "health": {
      "enabled": true,
      "check_interval": "60s",
      "cache_ttl": "120s",
      "default_timeout": "10s",
      "parallel_checks": true
    }
  }
}
```

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Prometheus + Grafana

```yaml
# docker-compose.yml –¥–ª—è monitoring stack
version: '3.8'
services:
  timeline-studio:
    image: timeline-studio:latest
    ports:
      - "3000:3000"
      - "9090:9090"  # Prometheus –º–µ—Ç—Ä–∏–∫–∏
    environment:
      - TELEMETRY_ENABLED=true
      - PROMETHEUS_PORT=9090
    
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9091:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--storage.tsdb.retention.time=200h'
      - '--web.enable-lifecycle'
      
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana-storage:/var/lib/grafana
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana/datasources:/etc/grafana/provisioning/datasources

volumes:
  grafana-storage:
```

```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'timeline-studio'
    static_configs:
      - targets: ['timeline-studio:9090']
    scrape_interval: 10s
    metrics_path: '/metrics'
    
rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

### Jaeger –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

```yaml
# docker-compose –¥–ª—è Jaeger
  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "16686:16686"   # Jaeger UI
      - "14268:14268"   # HTTP collector
      - "14250:14250"   # gRPC collector
    environment:
      - COLLECTOR_OTLP_ENABLED=true
      - SPAN_STORAGE_TYPE=memory
```

### ELK Stack –¥–ª—è –ª–æ–≥–æ–≤

```yaml
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.4.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
      
  logstash:
    image: docker.elastic.co/logstash/logstash:8.4.0
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    ports:
      - "5044:5044"
      
  kibana:
    image: docker.elastic.co/kibana/kibana:8.4.0
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
```

## üö® –ê–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### Prometheus Alert Rules

```yaml
# alert_rules.yml
groups:
  - name: timeline-studio-alerts
    rules:
      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
      - alert: HighCPUUsage
        expr: system_cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is {{ $value }}% for more than 5 minutes"
          
      # –ù–∏–∑–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ
      - alert: SlowVideoProcessing
        expr: rate(video_processing_duration_ms_sum[5m]) / rate(video_processing_duration_ms_count[5m]) > 30000
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Slow video processing detected"
          description: "Average video processing time is {{ $value }}ms"
          
      # –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ API
      - alert: HighAPIErrorRate
        expr: rate(api_errors_total[5m]) / rate(api_requests_total[5m]) > 0.1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "High API error rate"
          description: "API error rate is {{ $value | humanizePercentage }}"
          
      # –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞
      - alert: DiskSpaceLow
        expr: (system_disk_available_bytes / system_disk_usage_bytes) < 0.1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Disk space running low"
          description: "Less than 10% disk space remaining"
          
      # Unhealthy —Å–µ—Ä–≤–∏—Å—ã
      - alert: ServiceUnhealthy
        expr: system_health_status == 3
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Service is unhealthy"
          description: "Health check indicates service is in unhealthy state"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```rust
// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–ª–µ—Ä—Ç–æ–≤
use timeline_studio::core::telemetry::{AlertManager, AlertRule, AlertSeverity};

async fn setup_alerting() -> Result<()> {
    let alert_manager = AlertManager::new();
    
    // –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    alert_manager.add_rule(AlertRule {
        name: "slow_video_processing".to_string(),
        condition: "video_processing_duration_ms_avg > 30000".to_string(),
        severity: AlertSeverity::Warning,
        description: "Video processing is taking too long".to_string(),
        cooldown: Duration::from_minutes(5),
        actions: vec![
            AlertAction::Email {
                recipients: vec!["admin@timeline-studio.com".to_string()],
                subject: "Performance Alert: Slow Video Processing".to_string(),
            },
            AlertAction::Webhook {
                url: "https://hooks.slack.com/services/...".to_string(),
                payload: serde_json::json!({
                    "text": "üö® Video processing performance degraded",
                    "channel": "#alerts"
                }),
            },
        ],
    }).await?;
    
    // –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫
    alert_manager.add_rule(AlertRule {
        name: "high_error_rate".to_string(),
        condition: "api_errors_rate_5m > 0.1".to_string(),
        severity: AlertSeverity::Critical,
        description: "API error rate is too high".to_string(),
        cooldown: Duration::from_minutes(1),
        actions: vec![
            AlertAction::PagerDuty {
                service_key: "your-pagerduty-key".to_string(),
                description: "Critical: High API error rate in Timeline Studio".to_string(),
            },
        ],
    }).await?;
    
    Ok(())
}
```

## üîç Troubleshooting

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –ø–∞–º—è—Ç–∏
curl http://localhost:9090/metrics | grep memory

# –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Grafana query
sum(rate(memory_usage_bytes[5m])) by (component)

# –ü–æ–∏—Å–∫ memory leaks –≤ —Ç—Ä–µ–π—Å–∞—Ö
# Jaeger UI -> Service: timeline-studio -> Operation: memory_allocation
```

#### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ
```bash
# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:9090/metrics | grep video_processing_duration

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ —Ç—Ä–µ–π—Å—ã
# Jaeger UI -> –ø–æ–∏—Å–∫ spans —Å duration > 30s
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –º–µ—Ç—Ä–∏–∫
```rust
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
let telemetry = TelemetryManager::get_instance();
let export_status = telemetry.get_export_status().await;

for (exporter, status) in export_status {
    match status {
        ExportStatus::Healthy => println!("{} exporter is working", exporter),
        ExportStatus::Failed(error) => println!("{} exporter failed: {}", exporter, error),
        ExportStatus::Degraded(warning) => println!("{} exporter degraded: {}", exporter, warning),
    }
}
```

### Debugging —Ç—Ä–µ–π—Å–æ–≤

```rust
// –í–∫–ª—é—á–µ–Ω–∏–µ debug —É—Ä–æ–≤–Ω—è –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
let config = TelemetryConfig {
    tracing: TracingConfig {
        enabled: true,
        sample_rate: 1.0,  // 100% –¥–ª—è debugging
        debug_mode: true,
        log_spans: true,
        exporters: vec![
            TracingExporter::Console,  // –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è debug
            TracingExporter::File { path: "./debug_traces.json".to_string() },
        ],
        ..Default::default()
    },
    ..Default::default()
};

// –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
tracer.trace_async("debug_video_processing", |span| async move {
    span.set_attribute("debug", "true");
    span.set_attribute("input_file_size", &file_size.to_string());
    
    // –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
    span.add_event("input_validation_start");
    validate_input().await?;
    span.add_event("input_validation_end");
    
    span.add_event("preprocessing_start");
    let preprocessed = preprocess_video().await?;
    span.add_event("preprocessing_end");
    span.set_attribute("preprocessed_frames", &preprocessed.frame_count.to_string());
    
    span.add_event("encoding_start");
    let encoded = encode_video(preprocessed).await?;
    span.add_event("encoding_end");
    span.set_attribute("output_size", &encoded.size.to_string());
    
    Ok(encoded)
}).await
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã

- [**Backend Architecture**](../02-architecture/backend.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ backend
- [**Performance Optimization**](../08-roadmap/planned/performance-optimization.md) - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [**Backend Testing**](../08-roadmap/in-progress/backend-testing-architecture.md) - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backend
- [**Development Commands**](../05-development/development-commands.md) - –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 24 –∏—é–Ω—è 2025*