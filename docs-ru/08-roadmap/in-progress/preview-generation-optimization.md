# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–≤—å—é

## –°—Ç–∞—Ç—É—Å: –í –ø—Ä–æ—Ü–µ—Å—Å–µ

**–ù–∞—á–∞—Ç–æ:** 2025-01-21  
**–û–∂–∏–¥–∞–µ–º–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** 2025-01-25  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** AI Assistant + Developer

## –û–ø–∏—Å–∞–Ω–∏–µ

–£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–≤—å—é –¥–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞.

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- [x] –ò–∑—É—á–µ–Ω–∞ —Ç–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–≤—å—é
- [x] –í—ã—è–≤–ª–µ–Ω—ã —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
- [x] –û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π IndexedDBCacheService —Å –≥–æ—Ç–æ–≤–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ–≤—å—é

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
   - –ü—Ä–µ–≤—å—é –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
   - –ù–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–æ–≤
   - Base64 encoding/decoding —Å–æ–∑–¥–∞–µ—Ç overhead

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**:
   - –í—Å–µ –ø—Ä–µ–≤—å—é —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –≤ HashMap
   - –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
   - –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–µ–≤—å—é

3. **UX**:
   - –ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
   - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (WebP)
   - –ù–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –§–æ–Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (1-2 –¥–Ω—è)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä –ø—É–ª –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∏–º–ø–æ—Ä—Ç–∞ –º–µ–¥–∏–∞

### –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (1 –¥–µ–Ω—å)
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π IndexedDBCacheService
- [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–µ—Ç–æ–¥—ã cachePreview/getCachedPreview –≤ useMediaPreview
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ deletePreview –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–µ–≤—å—é –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ (usePreviewPreloader)
- [x] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ (1 –¥–µ–Ω—å)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É WebP
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π JPEG
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö viewport

### –§–∞–∑–∞ 4: UX —É–ª—É—á—à–µ–Ω–∏—è (1 –¥–µ–Ω—å)
- [ ] –î–æ–±–∞–≤–∏—Ç—å lazy loading —Å Intersection Observer
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å placeholder —Å blur —ç—Ñ—Ñ–µ–∫—Ç–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Backend (Rust)
```rust
// –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –≤–æ—Ä–∫–µ—Ä –ø—É–ª–∞
pub struct PreviewWorkerPool {
    workers: Vec<Worker>,
    sender: mpsc::Sender<PreviewJob>,
}
```

### Frontend (TypeScript)
```typescript
// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IndexedDBCacheService
import { indexedDBCacheService } from '@/features/media/services/indexeddb-cache-service';

// –í useMediaPreview —Ö—É–∫–µ
const getPreviewData = async (fileId: string) => {
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º IndexedDB –∫—ç—à
    const cached = await indexedDBCacheService.getCachedPreview(fileId);
    if (cached) return { base64_data: cached };
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å –±—ç–∫–µ–Ω–¥–∞
    const data = await invoke<MediaPreviewData>('get_media_preview_data', { fileId });
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    if (data?.browser_thumbnail?.base64_data) {
        await indexedDBCacheService.cachePreview(fileId, data.browser_thumbnail.base64_data);
    }
    
    return data;
};
```

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–≤—å—é < 100ms
- –†–∞–∑–º–µ—Ä –∫—ç—à–∞ –≤ –ø–∞–º—è—Ç–∏ < 100MB
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å 50 –ø—Ä–µ–≤—å—é < 1s
- –†–∞–∑–º–µ—Ä –ø—Ä–µ–≤—å—é —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ 40% (WebP)

## –†–∏—Å–∫–∏
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å WebP –≤ —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–µ–≤—å—é

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- FFmpeg –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `image` crate –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `lru` crate –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

## –ü—Ä–æ–≥—Ä–µ—Å—Å

### 2025-01-21
- ‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ—Å—Ç–∞–≤–ª–µ–Ω –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç –≤ roadmap
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω –≥–æ—Ç–æ–≤—ã–π IndexedDBCacheService —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–≤—å—é
- ‚úÖ –£—Ç–æ—á–Ω–µ–Ω –ø–ª–∞–Ω —Å —É—á–µ—Ç–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω IndexedDB –∫—ç—à –≤ useMediaPreview
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ deletePreview –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ö—É–∫ usePreviewPreloader –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
- ‚úÖ –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (29 —Ç–µ—Å—Ç–æ–≤, –≤—Å–µ –ø—Ä–æ—à–ª–∏)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã use-media-preview (20 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è usePreviewPreloader —Ö—É–∫–∞ (9 —Ç–µ—Å—Ç–æ–≤, 100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è media (README.md, DEV.md)
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- üîÑ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ù–∞—á–∞—Ç—å –§–∞–∑—É 1 - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä –ø—É–ª–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ