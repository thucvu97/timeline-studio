# ะะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ ััะฝะบัะธะธ "ะัะธะผะตะฝะธัั" ะดะปั ะฟัะตะดะฟัะพัะผะพััะฐ

## ๐ ะะฟะธัะฐะฝะธะต ััะฝะบัะธะพะฝะฐะปะฐ

ะะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ะบะฝะพะฟะบั "ะัะธะผะตะฝะธัั" ะฝะฐ ะฟัะตะฒัั ัััะตะบัะฐ, ัะธะปัััะฐ ะธะปะธ ัะฐะฑะปะพะฝะฐ, ะบะพะฝัะตะฝั ะดะพะปะถะตะฝ ะพัะพะฑัะฐะถะฐัััั ะฒ ะพัะฝะพะฒะฝะพะผ ะฒะธะดะตะพ ะฟะปะตะตัะต ะดะปั ะดะตัะฐะปัะฝะพะณะพ ะฟัะพัะผะพััะฐ.

## ๐ฏ ะัะฝะพะฒะฝัะต ััะตะฝะฐัะธะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### 1. ะัะธะผะตะฝะตะฝะธะต ะธะท ะฑัะฐัะทะตัะฐ ะผะตะดะธะฐัะฐะนะปะพะฒ
- ะะพะปัะทะพะฒะฐัะตะปั ะฒัะฑะธัะฐะตั ะฒะธะดะตะพ ะฒ ะฑัะฐัะทะตัะต
- ะะฐะถะธะผะฐะตั "ะัะธะผะตะฝะธัั" ะฝะฐ ะฟัะตะฒัั
- ะะธะดะตะพ ะฝะฐัะธะฝะฐะตั ะฒะพัะฟัะพะธะทะฒะพะดะธัััั ะฒ ะพัะฝะพะฒะฝะพะผ ะฟะปะตะตัะต

### 2. ะัะธะผะตะฝะตะฝะธะต ัััะตะบัะพะฒ/ัะธะปัััะพะฒ
- ะะพะปัะทะพะฒะฐัะตะปั ะฒัะฑัะฐะป ะฒะธะดะตะพ (ะธะท ะฑัะฐัะทะตัะฐ ะธะปะธ ะฟัะธะผะตะฝะธะป ัะฐะฝะตะต)
- ะัะฑะธัะฐะตั ัััะตะบั/ัะธะปััั
- ะะฐะถะธะผะฐะตั "ะัะธะผะตะฝะธัั"
- ะญััะตะบั ะฟัะธะผะตะฝัะตััั ะบ ัะตะบััะตะผั ะฒะธะดะตะพ ะฒ ะฟะปะตะตัะต

### 3. ะัะธะผะตะฝะตะฝะธะต ัะฐะฑะปะพะฝะพะฒ
- **ะะดะฝะพะบะฐะผะตัะฝัะต ัะฐะฑะปะพะฝั**: ะธัะฟะพะปัะทัะตััั ัะตะบััะตะต ะฒัะฑัะฐะฝะฝะพะต ะฒะธะดะตะพ
- **ะะฝะพะณะพะบะฐะผะตัะฝัะต ัะฐะฑะปะพะฝั**: 
  - ะะตัะฒะพะต ะฒะธะดะตะพ = ัะตะบััะตะต ะฒัะฑัะฐะฝะฝะพะต
  - ะััะฐะปัะฝัะต = ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธะท ะฑัะฐัะทะตัะฐ (ัะปะตะดัััะธะต ะฟะพ ะฟะพััะดะบั)

## ๐๏ธ ะััะพัะฝะธะบะธ ะฒะธะดะตะพ

### ะะตัะตะบะปััะฐัะตะปั ัะตะถะธะผะพะฒ
ะ ะฟะฐะฝะตะปะธ ัะฟัะฐะฒะปะตะฝะธั ะฒะธะดะตะพ ะตััั ะฟะตัะตะบะปััะฐัะตะปั ะผะตะถะดั ะดะฒัะผั ะธััะพัะฝะธะบะฐะผะธ:

1. **ะะตะถะธะผ "ะัะฐัะทะตั"** (Browser Mode)
   - ะะธะดะตะพ ะฑะตััััั ะธะท ัะตะบััะตะน ะฒะบะปะฐะดะบะธ ะฑัะฐัะทะตัะฐ ะผะตะดะธะฐัะฐะนะปะพะฒ
   - ะะปั ะผะฝะพะณะพะบะฐะผะตัะฝัั ัะฐะฑะปะพะฝะพะฒ: ะฒัะฑัะฐะฝะฝะพะต + ัะปะตะดัััะธะต ะฟะพ ะฟะพััะดะบั

2. **ะะตะถะธะผ "ะขะฐะนะผะปะฐะนะฝ"** (Timeline Mode)
   - ะะธะดะตะพ ะฑะตััััั ะธะท ัะตะบััะตะน ะฟะพะทะธัะธะธ ัะฐะนะผะปะฐะนะฝะฐ
   - ะะปั ะผะฝะพะณะพะบะฐะผะตัะฝัั ัะฐะฑะปะพะฝะพะฒ: ะฒะธะดะตะพ ั ะฟะฐัะฐะปะปะตะปัะฝัั ััะตะบะพะฒ ะฒ ัะตะบััะธะน ะผะพะผะตะฝั ะฒัะตะผะตะฝะธ

### ะกัััะบัััะฐ ะดะฐะฝะฝัั ะดะปั ะธััะพัะฝะธะบะพะฒ

```typescript
// ะขะธะฟ ะธััะพัะฝะธะบะฐ ะฒะธะดะตะพ
type VideoSource = 'browser' | 'timeline'

// ะะพะฝัะตะบัั ะฟัะธะผะตะฝะตะฝะธั
interface ApplyContext {
  source: VideoSource
  // ะะปั ะฑัะฐัะทะตัะฐ
  browserFiles?: MediaFile[]
  selectedFile?: MediaFile
  // ะะปั ัะฐะนะผะปะฐะนะฝะฐ
  timelinePosition?: number
  timelineTracks?: Track[]
}

// ะะฐััะธัะตะฝะฝะพะต ัะพััะพัะฝะธะต ะฟะปะตะตัะฐ
interface PlayerState {
  // ... ัััะตััะฒัััะธะต ะฟะพะปั
  videoSource: VideoSource
  applyContext: ApplyContext
}
```

## ๐๏ธ ะััะธัะตะบัััะฐ ัะตัะตะฝะธั

### ะะพะผะฟะพะฝะตะฝัั ะดะปั ะธะทะผะตะฝะตะฝะธั

1. **MediaPreview** (`/features/browser/components/preview/media-preview.tsx`)
   - ะะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพััะธะบ ะดะปั ะบะฝะพะฟะบะธ "ะัะธะผะตะฝะธัั"
   - ะะตัะตะดะฐะฒะฐัั ะฒัะฑัะฐะฝะฝัะน ัะฐะนะป ะฒ PlayerProvider

2. **EffectPreview** (`/features/effects/components/effect-preview.tsx`)
   - ะะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพััะธะบ ะฟัะธะผะตะฝะตะฝะธั ัััะตะบัะฐ
   - ะัะฟะพะปัะทะพะฒะฐัั ัะตะบััะธะน ัะฐะนะป ะธะท PlayerProvider

3. **FilterPreview** (`/features/filters/components/filter-preview.tsx`)
   - ะะฝะฐะปะพะณะธัะฝะพ EffectPreview

4. **TemplatePreview** (`/features/templates/components/template-preview.tsx`)
   - ะะฟัะตะดะตะปััั ะบะพะปะธัะตััะฒะพ ะฝะตะพะฑัะพะดะธะผัั ะฒะธะดะตะพ
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะดะฑะธัะฐัั ะฒะธะดะตะพ ะธะท ะฑัะฐัะทะตัะฐ

5. **StyleTemplatePreview** (`/features/style-templates/components/style-template-preview.tsx`)
   - ะัะธะผะตะฝััั ััะธะปั ะบ ัะตะบััะตะผั ะฒะธะดะตะพ

### ะกะตัะฒะธัั ะธ ััะบะธ

1. **PlayerProvider** (`/features/video-player/services/player-provider.tsx`)
   - ะะพะฑะฐะฒะธัั ะผะตัะพะด `setPreviewMedia(file: MediaFile)`
   - ะะพะฑะฐะฒะธัั ะผะตัะพะด `applyEffect(effect: VideoEffect)`
   - ะะพะฑะฐะฒะธัั ะผะตัะพะด `applyFilter(filter: VideoFilter)`
   - ะะพะฑะฐะฒะธัั ะผะตัะพะด `applyTemplate(template: Template, files: MediaFile[])`

2. **useMedia** (`/features/browser/media/use-media.ts`)
   - ะะพะฑะฐะฒะธัั ะผะตัะพะด `getFilesForTemplate(count: number): MediaFile[]`
   - ะะพะทะฒัะฐัะฐัั ัะตะบััะธะน ะฒัะฑัะฐะฝะฝัะน ัะฐะนะป + ัะปะตะดัััะธะต ะฟะพ ะฟะพััะดะบั

3. **usePlayer** (`/features/video-player/services/player-provider.tsx`)
   - ะะฐััะธัะธัั ัะพััะพัะฝะธะต ะดะปั ััะฐะฝะตะฝะธั ะฟัะธะผะตะฝะตะฝะฝัั ัััะตะบัะพะฒ/ัะธะปัััะพะฒ
   - ะะพะฑะฐะฒะธัั ะฟะพะดะดะตัะถะบั ะบะพะผะฟะพะทะธัะฝัั ัะฐะฑะปะพะฝะพะฒ

## ๐ ะะตัะฐะปัะฝัะน ะฟะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ

### ะญัะฐะฟ 1: ะะฐะทะพะฒะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั (ะัะธะผะตะฝะตะฝะธะต ะฒะธะดะตะพ)

```typescript
// ะ MediaPreview ะดะพะฑะฐะฒะธัั:
const handleApply = () => {
  const { setPreviewMedia } = usePlayer()
  setPreviewMedia(file)
}

// ะ PlayerProvider ะดะพะฑะฐะฒะธัั:
const setPreviewMedia = (file: MediaFile) => {
  // ะฃััะฐะฝะพะฒะธัั ะฒะธะดะตะพ ะฒ ะฟะปะตะตั
  // ะกะฑัะพัะธัั ัััะตะบัั/ัะธะปัััั
  // ะะฐัะฐัั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะต
}
```

### ะญัะฐะฟ 2: ะัะธะผะตะฝะตะฝะธะต ัััะตะบัะพะฒ/ัะธะปัััะพะฒ

```typescript
// ะ EffectPreview:
const handleApply = () => {
  const { applyEffect, currentMedia } = usePlayer()
  if (currentMedia) {
    applyEffect(effect)
  } else {
    toast.error("ะกะฝะฐัะฐะปะฐ ะฒัะฑะตัะธัะต ะฒะธะดะตะพ")
  }
}

// ะ PlayerProvider:
const applyEffect = (effect: VideoEffect) => {
  // ะะพะฑะฐะฒะธัั ัััะตะบั ะบ ัะตะบััะตะผั ะฒะธะดะตะพ
  // ะะฑะฝะพะฒะธัั CSS ััะธะปะธ ะฒะธะดะตะพ ัะปะตะผะตะฝัะฐ
}
```

### ะญัะฐะฟ 3: ะะพะดะดะตัะถะบะฐ ัะฐะฑะปะพะฝะพะฒ

```typescript
// ะ TemplatePreview:
const handleApply = () => {
  const { applyTemplate, videoSource } = usePlayer()
  const { getFilesForTemplate } = useMedia()
  const { getTracksAtPosition } = useTimeline()
  
  const requiredVideos = template.requiredVideos || 1
  let files: MediaFile[] = []
  
  if (videoSource === 'browser') {
    // ะะตะถะธะผ ะฑัะฐัะทะตัะฐ: ะฒัะฑัะฐะฝะฝะพะต + ัะปะตะดัััะธะต
    files = getFilesForTemplate(requiredVideos)
  } else {
    // ะะตะถะธะผ ัะฐะนะผะปะฐะนะฝะฐ: ะฒะธะดะตะพ ั ะฟะฐัะฐะปะปะตะปัะฝัั ััะตะบะพะฒ
    const tracks = getTracksAtPosition(currentTime)
    files = tracks
      .filter(track => track.type === 'video')
      .slice(0, requiredVideos)
      .map(track => track.currentClip?.mediaFile)
      .filter(Boolean)
  }
  
  if (files.length < requiredVideos) {
    toast.error(`ะะตะพะฑัะพะดะธะผะพ ${requiredVideos} ะฒะธะดะตะพ`)
    return
  }
  
  applyTemplate(template, files)
}
```

### ะญัะฐะฟ 4: ะะพะณะธะบะฐ ะฒัะฑะพัะฐ ะฒะธะดะตะพ

```typescript
// ะะพะฒัะน ััะบ ะดะปั ัะฝะธัะธะบะฐัะธะธ ะฒัะฑะพัะฐ ะฒะธะดะตะพ
function useVideoSelection() {
  const { videoSource } = usePlayer()
  const { selectedFiles, groupedFiles } = useMedia()
  const { currentTime, tracks } = useTimeline()
  
  const getVideosForPreview = (count: number = 1): MediaFile[] => {
    if (videoSource === 'browser') {
      // ะะท ะฑัะฐัะทะตัะฐ
      const selected = selectedFiles[0]
      const allFiles = groupedFiles.flatMap(g => g.files)
      const startIndex = selected ? allFiles.indexOf(selected) : 0
      
      return allFiles.slice(startIndex, startIndex + count)
    } else {
      // ะะท ัะฐะนะผะปะฐะนะฝะฐ
      return tracks
        .filter(track => track.type === 'video')
        .map(track => {
          const clip = track.clips.find(c => 
            c.startTime <= currentTime && 
            c.endTime >= currentTime
          )
          return clip?.mediaFile
        })
        .filter(Boolean)
        .slice(0, count)
    }
  }
  
  return { getVideosForPreview }
}
```

## ๐ ะกะพััะพัะฝะธะต ะฟะปะตะตัะฐ

```typescript
interface PlayerState {
  // ะกััะตััะฒัััะธะต ะฟะพะปั
  currentTime: number
  duration: number
  isPlaying: boolean
  
  // ะะพะฒัะต ะฟะพะปั
  previewMedia: MediaFile | null
  appliedEffects: VideoEffect[]
  appliedFilters: VideoFilter[]
  appliedTemplate: {
    template: Template
    files: MediaFile[]
  } | null
}
```

## ๐จ UI/UX ัะพะพะฑัะฐะถะตะฝะธั

1. **ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั**
   - ะะพะดัะฒะตัะบะฐ ะบะฝะพะฟะบะธ "ะัะธะผะตะฝะธัั" ะฟัะธ ะฝะฐะฒะตะดะตะฝะธะธ
   - ะะฝะดะธะบะฐัะธั ะทะฐะณััะทะบะธ ะฟัะธ ะฟัะธะผะตะฝะตะฝะธะธ
   - ะฃะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ััะฟะตัะฝะพะผ ะฟัะธะผะตะฝะตะฝะธะธ

2. **ะกะพััะพัะฝะธะต ะบะฝะพะฟะบะธ**
   - ะะบัะธะฒะฝะฐ ะฒัะตะณะดะฐ ะดะปั ะผะตะดะธะฐัะฐะนะปะพะฒ
   - ะะปั ัััะตะบัะพะฒ/ัะธะปัััะพะฒ - ัะพะปัะบะพ ะตัะปะธ ะตััั ะฒะธะดะตะพ
   - ะะปั ะผะฝะพะณะพะบะฐะผะตัะฝัั ัะฐะฑะปะพะฝะพะฒ - ะฟัะพะฒะตัะบะฐ ะดะพััะฐัะพัะฝะพััะธ ัะฐะนะปะพะฒ

3. **ะกะฑัะพั ัะพััะพัะฝะธั**
   - ะัะธ ะฒัะฑะพัะต ะฝะพะฒะพะณะพ ะฒะธะดะตะพ ัะฑัะฐััะฒะฐัั ัััะตะบัั
   - ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบั "ะกะฑัะพัะธัั" ะฒ ะฟะปะตะตัะต

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

1. **Unit ัะตััั**
   - ะขะตััั ะดะปั ะฝะพะฒัั ะผะตัะพะดะพะฒ ะฒ PlayerProvider
   - ะขะตััั ะดะปั ะปะพะณะธะบะธ ะฒัะฑะพัะฐ ัะฐะนะปะพะฒ

2. **ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั**
   - ะัะธะผะตะฝะตะฝะธะต ะฒะธะดะตะพ โ ัััะตะบั โ ัะธะปััั
   - ะัะธะผะตะฝะตะฝะธะต ะผะฝะพะณะพะบะฐะผะตัะฝะพะณะพ ัะฐะฑะปะพะฝะฐ
   - ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ (ะฝะตะดะพััะฐัะพัะฝะพ ัะฐะนะปะพะฒ)

3. **E2E ัะตััั**
   - ะะพะปะฝัะน ััะตะฝะฐัะธะน ะพั ะฒัะฑะพัะฐ ะดะพ ะฟัะธะผะตะฝะตะฝะธั
   - ะัะพะฒะตัะบะฐ ะฒะธะทัะฐะปัะฝะพะณะพ ัะตะทัะปััะฐัะฐ

## ๐ ะัะธะผะตัั ััะตะฝะฐัะธะตะฒ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะกัะตะฝะฐัะธะน 1: ะญััะตะบั ะธะท ะฑัะฐัะทะตัะฐ
```typescript
// ะกะพััะพัะฝะธะต: videoSource = 'browser', ะฒัะฑัะฐะฝะพ video1.mp4
// ะะตะนััะฒะธะต: ะัะธะผะตะฝะธัั ัััะตะบั "ะะฐะทะผััะธะต"
// ะะตะทัะปััะฐั: 
{
  previewMedia: video1.mp4,
  appliedEffects: [BlurEffect],
  videoSource: 'browser'
}
```

### ะกัะตะฝะฐัะธะน 2: 4-ะบะฐะผะตัะฝัะน ัะฐะฑะปะพะฝ ะธะท ัะฐะนะผะปะฐะนะฝะฐ
```typescript
// ะกะพััะพัะฝะธะต: videoSource = 'timeline', currentTime = 10s
// ะขัะตะบะธ: [video1.mp4, video2.mp4, video3.mp4, video4.mp4]
// ะะตะนััะฒะธะต: ะัะธะผะตะฝะธัั ัะฐะฑะปะพะฝ "Grid 2x2"
// ะะตะทัะปััะฐั:
{
  appliedTemplate: {
    template: Grid2x2Template,
    files: [video1.mp4, video2.mp4, video3.mp4, video4.mp4]
  },
  videoSource: 'timeline'
}
```

### ะกัะตะฝะฐัะธะน 3: ะะตัะตะบะปััะตะฝะธะต ะธััะพัะฝะธะบะฐ
```typescript
// ะัะปะพ: videoSource = 'browser', ะฟัะธะผะตะฝะตะฝ ัััะตะบั
// ะะตะนััะฒะธะต: ะะตัะตะบะปััะธัั ะฝะฐ 'timeline'
// ะะตะทัะปััะฐั: ะกะฑัะพั ัััะตะบัะพะฒ, ะทะฐะณััะทะบะฐ ะฒะธะดะตะพ ั ัะตะบััะตะน ะฟะพะทะธัะธะธ ัะฐะนะผะปะฐะนะฝะฐ
```

## ๐ ะะธะฐะณัะฐะผะผะฐ ะฟะพัะพะบะฐ ะดะฐะฝะฝัั

```
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโ
โ   Browser   โ     โ  Timeline    โ       โ   Player    โ
โ   Mode      โ     โ  Mode        โ       โ             โ
โโโโโโโโฌโโโโโโโ     โโโโโโโโฌโโโโโโโโ       โโโโโโโโฌโโโโโโโ
       โ                    โ                     โ
       โ getVideos()        โ getTracksAt()       โ
       โโโโโโโโโโโโโโฌโโโโโโโโ                     โ
                    โ                             โ
                    โผ                             โ
            โโโโโโโโโโโโโโโโโ                     โ
            โ VideoSelectionโ                     โ
            โ    Hook       โ                     โ
            โโโโโโโโโฌโโโโโโโโ                     โ
                    โ                             โ
                    โ files[]                     โ
                    โผ                             โ
            โโโโโโโโโโโโโโโโโ                     โ
            โ   Preview     โ โโโโ apply() โโโโโโโบโ
            โ  Component    โ                     โ
            โโโโโโโโโโโโโโโโโ                     โ
```

## ๐ ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ

- **ะญัะฐะฟ 1**: 2-3 ัะฐัะฐ (ะฑะฐะทะพะฒะพะต ะฟัะธะผะตะฝะตะฝะธะต ะฒะธะดะตะพ)
- **ะญัะฐะฟ 2**: 3-4 ัะฐัะฐ (ัััะตะบัั ะธ ัะธะปัััั)
- **ะญัะฐะฟ 3**: 4-5 ัะฐัะพะฒ (ัะฐะฑะปะพะฝั)
- **ะญัะฐะฟ 4**: 2-3 ัะฐัะฐ (ะธะฝัะตะณัะฐัะธั ะธััะพัะฝะธะบะพะฒ)
- **ะขะตััะธัะพะฒะฐะฝะธะต**: 3-4 ัะฐัะฐ
- **ะัะพะณะพ**: ~14-18 ัะฐัะพะฒ

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

1. ะะฐัะฐัั ั ัะตะฐะปะธะทะฐัะธะธ `setPreviewMedia` ะฒ PlayerProvider
2. ะะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพััะธะบ ะฒ MediaPreview
3. ะัะพัะตััะธัะพะฒะฐัั ะฑะฐะทะพะฒัั ััะฝะบัะธะพะฝะฐะปัะฝะพััั
4. ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพ ะดะพะฑะฐะฒะปััั ะฟะพะดะดะตัะถะบั ัััะตะบัะพะฒ, ัะธะปัััะพะฒ ะธ ัะฐะฑะปะพะฝะพะฒ